
## Функциональность 

- Сбор параметров в течении недели
- Отправка в понедельник параметров за предыдущую неделю

## Параметры

- Сколько прошел шагов
- Сколько спал в среднем
- Насколько % больше/меньше спал, чем средний человек

##  Вопросы

- Как реализовать подобную функциональность? В чем видите основную сложность?
- Какой профиль нагрузки у такой функциональности будет в течении недели? В день отправки?
- Какой объем данных о сне нужно будет хранить, чтобы отправить затем среднее по сну? Что если в какой-то день данных не будет?
- Какие возникнут сложности, если пользователей станет 10 млн?


## Ответы

### Как реализовать подобную функциональность


- Хранение данных в реляционной БД, скажем PostgreSQL
- Backend framework: FastAPI
  - Предварительное планирование RestAPI через OpenAPI
- Логгирование 
  - Splunk или Sentry
- Отправка писем через специализированный сервис, скажем Maingun, Mailchimp
  - возможно стоит использовать несколько на случай downtime одной из них
- Все необходимые вычисления производить до понедельника (вычисления средних значений)
- Использование очереди сообщений для формирования заданий на отправку emails (Celery+RabbitMQ)
- "Размазывание" времени отправки в течении всего понедельника
  - Возможна динамическая оркестрация, если мы привязаны к таймзоне пользователя

### В чем видите основную сложность

- Проверка в гарантированной доставке
- Взаимодействии со службой отправки emails (время отклика)
- Настройка очередей сообщений


### Какой профиль нагрузки у такой функциональности будет в течении недели? 

- В конце каждого дня = кол-во пользователей * (кол-во параметров+необходимые вычисления средних значений)

### В день отправки?

- В понедельник = ( формирование отчета ) * кол-во пользователей + (отправка отчета) * кол-во пользователей

### Какие возникнут сложности, если пользователей станет 10 млн?

- Оркестрация отправки сообщений: 
  - Очереди
  - Службы отправки
- Быстродействие БД
  - индексы
  - горизонтальное масштабирование
  - отказоустойчивость (кластеры)

## Глоссарий

### Профиль нагрузки

https://qna.habr.com/q/518772
Что определяет профиль нагрузки?
A. Количество конкурентных пользователей Системы
B. Ожидаемую загрузку аппаратных ресурсов
C. Различия между тестовым и промышленным стендом
D. Состав операций и их количество в рамках теста

http://www.protesting.ru/automation/load/terminology.html
Профиль нагрузки (Performance Profile) - это набор операций с заданными интенсивностями, полученный на основе сбора статистических данных либо определенный путем анализа требований к тестируемой системе

